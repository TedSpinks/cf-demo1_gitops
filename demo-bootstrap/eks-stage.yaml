apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: demo1-stage
  region: us-east-2
  version: "1.22"
  tags:
      owner: SA-Team
      cf-account: cf-demo1

managedNodeGroups:
  - name: managed-ng-1
    availabilityZones: ["us-east-2a"]
    minSize: 2
    maxSize: 6
    desiredCapacity: 2
    spot: true
    instanceTypes:   # Spot pricing, us-east-1 (https://aws.amazon.com/ec2/spot/pricing/), all have 2 vCPU, 8GB RAM (t3s are burstable)
      - "t3.large"   # $0.025 per Hour (intel)
      - "t3a.large"  # $0.0226 per Hour (amd)
      - "m6i.large"  # $0.0357 per Hour (intel)
      - "m5.large"   # $0.0396 per Hour (intel, ebs)
      - "m5a.large"  # $0.0351 per Hour (amd, ebs)
      - "m5d.large"  # $0.0348 per Hour (intel, local nvme)
      - "m5ad.large" # $0.034 per Hour  (amd, local nvme)
    volumeSize: 80
    labels:
      role: worker
    tags:
      nodegroup-role: worker
    iam:
      attachPolicy:
        Version: "2012-10-17"
        Statement:
        - Effect: Allow
          Action:
          - 's3:GetObject'
          - 's3:PutObject'
          Resource: 'arn:aws:s3:::cf-demo-1/*'
      withAddonPolicies:
        imageBuilder: true # ECR Access https://eksctl.io/usage/iam-policies/#image-builder-policy
